<head>
    <title id='title'>Murder Sim!</title>
</head>

<div id='div0' style='font-size: 20vw;
    position: fixed;
    top: 200px; left: 50%;
    transform: translate(-50%, -50%);'>
</div>

<h1 id='headline' style='font-size: 6vw' style='font-size: 20vw;
        text-align: center;'>
        Welcome to MurderSim!  Select whether this device is
        an emergency meeting device or a task device.
</h1>
<div id='div1'></div>

<br><br>

<button onclick="meetingButton()" id = 'b2'>Satellite</button>
<button onclick="task()" id = 'b3'>Special Task</button>
<br><br>
<button onclick='startGame()' id = 'b1'>Start game! (Main meeting room)</button>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>

var socket = io();

var div0 = document.getElementById('div0');

// listens for timer updates
socket.on('updateTimer', function(data) {
    var timer = new Date(data.date);
    div0.innerHTML = timer.toISOString().substr(14,5);
})

// listens for callMeeting
socket.on('callMeeting', function () {
    callMeeting();
})

// listens for endMeeting
socket.on('endMeeting', function () {
    endMeeting();
})

// Starts the timer and puts you in the game
function startGame() {
    socket.emit('endMeeting');
    meetingButton();
}

// Performs initial setup - creates the button, puts you in correct room
function meetingButton() {

    socket.emit('type', {
        type: 'meeting'
    });

    removeButtons();

    document.body.style = "background-color:green";

    document.getElementById('headline').innerHTML = "No Meeting Called";

    var emergencyButton = document.createElement('button');
    emergencyButton.id = "emergencyButton";
    emergencyButton.innerHTML = "CALL MEETING";
    emergencyButton.className = "emergencyButton";
    // sizes based on view width
    emergencyButton.style = "border-radius: 40vw;"
                        +   " height: 80vw;"
                        +   " width: 80vw;"
                        // These next three lines center it somehow
                        +   "position: fixed;"
                        +   "top: 80vw; left: 50%;"
                        +   "transform: translate(-50%, -50%);"
                        +   " background-color: pink;"
                        +   " font-size: 75px";
    emergencyButton.removeEventListener("click", emitEndMeeting);
    emergencyButton.addEventListener("click", emitCallMeeting);

    var div1 = document.getElementById('div1');
    div1.appendChild(emergencyButton);
}

// These functions emit signals without creating a loop where those signals then call themselves
function emitCallMeeting() {
    socket.emit('callMeeting');
}

function emitEndMeeting() {
    socket.emit('endMeeting');
}

// Calls emergency meeting
function callMeeting() {

    document.body.style = "background-color:red";

    document.getElementById('headline').innerHTML = "EMERGENCY MEETING";
    
    var emergencyButton = document.getElementById('emergencyButton');

    if (typeof(emergencyButton) != 'undefined' && emergencyButton != null) {
        emergencyButton.innerHTML = "End Meeting";

        // removes the onclick event from the emergency button and replaces
        emergencyButton.removeEventListener("click", emitCallMeeting);
        emergencyButton.addEventListener("click", emitEndMeeting);
    }
}

function endMeeting() {

    document.body.style = "background-color:green";

    document.getElementById('headline').innerHTML = "No Meeting Called";
    
    var emergencyButton = document.getElementById('emergencyButton');

    if (typeof(emergencyButton) != 'undefined' && emergencyButton != null) {
        emergencyButton.innerHTML = "CALL MEETING";

        // removes the onclick event from the emergency button and replaces
        emergencyButton.removeEventListener("click", emitEndMeeting);
        emergencyButton.addEventListener("click", emitCallMeeting);
    }
}

function task() {
    socket.emit('type', {
        type: 'task'
    });

    removeButtons();
}

function removeButtons() {
    document.getElementById("b1").remove();
    document.getElementById("b2").remove();
    document.getElementById("b3").remove();
}

</script>